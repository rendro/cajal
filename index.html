<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>

    <title>cajal - Draw and animate shapes on the HTML5 canvas element</title>
    <link href="style.css" rel="stylesheet" type="text/css">

    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"></script>
    
    <script type="text/javascript" src="js/cajal.js"></script>
    <script type="text/javascript" src="js/cajal.ease.js"></script>

    <script type="text/javascript" src="js/highlight.pack.js"></script>
    <script type="text/javascript">
    hljs.tabReplace = '    ';
    hljs.initHighlightingOnLoad();

    function initCajal() {
        var origin = {
                x: 1,
                y: 30
            },
            scale =0.33,
            hStyle = {
                fill: new cajal.LinearGradient(0, 0, 111 * scale, 0).colorStop(0, '#597a2e').colorStop(1, '#96cc51')
            },
            hStyleSmall = {
                fill: new cajal.LinearGradient(0, 0, 48 * scale, 0).colorStop(0, '#597a2e').colorStop(1, '#96cc51')
            },
            vStyle = {
                fill: new cajal.LinearGradient(0, 0, 0, 127 * scale).colorStop(1, '#597a2e').colorStop(0, '#96cc51')
            },
            c = new cajal('cajal'),
            leftLine    = new cajal.Path(0, 32 * scale).to(32 * scale, 0).to(32 * scale, 127 * scale).to(0, 95 * scale).close().options(vStyle),
            rightLine   = new cajal.Path(0, 0).to(32 * scale, 32 * scale).to(32 * scale, 127 * scale).to(0, 95 * scale).close().options(vStyle),
            topLine     = new cajal.Path(0, 32 * scale).to(32 * scale, 0).to(79 * scale, 0).to(111 * scale, 32 * scale).close().options(hStyle),
            bottomLine  = new cajal.Path(0, 0).to(111 * scale, 0).to(79 * scale, 32 * scale).to(32 * scale, 32 * scale).close().options(hStyle),
            bottomSmall = new cajal.Path(0, 0).to(79 * scale, 0).to(47 * scale, 32 * scale).to(32 * scale, 32 * scale).close().options(hStyle),
            longLineJ   = new cajal.Path(0, 32 * scale).to(32 * scale, 0).to(32 * scale, 143 * scale).to(0, 175 * scale).close().options(vStyle),
            longLineL   = new cajal.Path(0, 0).to(32 * scale, 32 * scale).to(32 * scale, 175 * scale).to(0, 143 * scale).close().options(vStyle),
            lBottom     = new cajal.Path(0, 0).to(48 * scale, 0).to(48 * scale, 32 * scale).to(32 * scale, 32 * scale).close().options(hStyleSmall),
            jBottom     = new cajal.Path(0, 0).to(48 * scale, 0).to(16 * scale, 32 * scale).to(0, 32 * scale).close().options(hStyleSmall);

        // C
        c.add('top-C',  topLine.clone().moveBy(origin.x, origin.y))
         .add('bottom-C',  bottomLine.clone().moveBy(origin.x, origin.y + 63 * scale))
         .add('left-C', leftLine.clone().moveBy(origin.x, origin.y))
         // A
         .add('right-A', rightLine.clone().moveBy(origin.x + 199 * scale, origin.y - 32 * scale))
         .add('top-A',  topLine.clone().moveBy(origin.x + 120 * scale, origin.y))
         .add('left-A', leftLine.clone().moveBy(origin.x + 120 * scale, origin.y))
         .add('bottom-A',  bottomSmall.clone().moveBy(origin.x + 120 * scale, origin.y + 63 * scale))
         // J
         .add('J1', longLineJ.clone().moveBy(origin.x + 245 * scale, origin.y))
         .add('J2', jBottom.clone().moveBy(origin.x + 229 * scale, origin.y + 111 * scale))
         // 2nd A
         .add('right-A2', rightLine.clone().moveBy(origin.x + 369 * scale, origin.y -32 * scale))
         .add('top-A2',  topLine.clone().moveBy(origin.x + 290 * scale, origin.y))
         .add('left-A2', leftLine.clone().moveBy(origin.x + 290 * scale, origin.y))
         .add('bottom-A2',  bottomSmall.clone().moveBy(origin.x + 290 * scale, origin.y + 63 * scale))
         // L
         .add('L1', longLineL.clone().moveBy(origin.x + 413 * scale, origin.y - 80 * scale))
         .add('L2', lBottom.clone().moveBy(origin.x + 413 * scale, origin.y + 63 * scale))
         //draw
         .draw();


        var anim = function (frame, duration) {
            for (var i in this.items) {
                this.items[i].item.rotateBy(cajal.Ease.expInOut(360,frame,duration,2));
                if (frame <= duration/2) {
                    this.items[i].item.scaleBy(-0.01,-0.01);
                } else {
                    this.items[i].item.scaleBy(0.01,0.01);
                }
            }
        }

        var animate = function () {
            c.animate(anim,'1s');
        }
        window.animate = animate;

    };
    </script>
</head>

<body onLoad="initCajal()">
    <div id="head">
        <canvas id="cajal" width="160" height="85" onclick="animate();"></canvas>
        <div class="buttons">
            <a class="button" href="https://github.com/dotsunited/cajal/tarball/master">Download Version 0.1</a>
        </div>
    </div>
    <div id="content">
        <h1>cajal</h1>
        <p>cajal is a javascript library to draw and animate shapes on the HTML5 canvas element.</p>

        <h2>Why you should use cajal?</h2>
        <p>cajal provides object oriantated functionality to draw and animate shapes on the canvas element. You can easily reuse animations or complex shape-objects in other projects, as every shape can be assinged to as many canvas elements on your site as you like.</p>
        <h3>Write less code</h3>
        <p>Due to easy implementation and chainable method calls you can create shapes in 2 to 3 lines of code. If you ever tried out the native canvas API, you know that you need at least three times more code and you can't handle it flexibly.</p>
        <h3>cajal never forgets</h3>
        <p>You can fetch and manipulate every element that you already drew to the canvas. Plus, you have a hit algorithm that returns the drawn element located at specific coordinates of your canvas to handle klick events and interaction with the canvas.</p>
        
        <h2>Examples</h2>
        <h3>Particle explosion</h3>
        <p>Click anywhere inside the black canvas area to create a particle explosion</p>
        <canvas id="particle-explosion" width="700" height="350" style="background:black;margin-bottom:2em;" onclick="particleCanvas.animate(emitter(event),100);"></canvas>
        <script type="text/javascript">
            var particleCanvas = new cajal('particle-explosion', {
                globalCompositeOperation: 'lighter',
                globalAlpha: 0.8
            });
            
            var emitter = function(e) {
                var particles = [];
                
                var click = {
                    x: (e.pageX || e.clientX + document.body.scrollLeft + document.documentElement.scrollLeft) - e.target.offsetLeft,
                    y: (e.pageY || e.clientY + document.body.scrollTop + document.documentElement.scrollTop)  -e.target.offsetTop
                };
                
                
                return function(f,t) {
                    
                    if (f < (t*0.05)) {
                        for (var count=0; count<=120; count++) {
                            var particle = {
                                item: new cajal.Circle(click.x, click.y, Math.round(Math.random()*7)).options({
                                    fill: 'rgba('+Math.round(Math.random()*255)+','+Math.round(Math.random()*50)+','+Math.round(Math.random()*255)+',' + Math.random() + ')'
                                }),
                                speed: {
                                    dx: ((Math.random()*2) - 1)*Math.random()*10,
                                    dy: ((Math.random()*2) - 1)*Math.random()*10
                                },
                                livecycle: 0
                            };
                            particles.push(particle);
                            this.add(particle.item);
                        }
                    }
                    
                    if (particles.length > 0) {
                        for (var i in particles) {
                            var p = particles[i];
                            p.item.moveBy(p.speed.dx, p.speed.dy);
                            
                            p.speed.dx *= 0.99;
                            p.speed.dy += 0.1;
                            
                            p.livecycle++;
                            
                            //animate opcity in the last 3/4 of animation
                            if (p.livecycle > t/4) {
                                p.item.drawOptions.fill = p.item.drawOptions.fill.replace(/,([0-9\.]+)\)$/g,',' + Math.random() + ')');
                                p.item.scaleBy(-0.01,-0.01);
                            }
                            
                            if (p.livecycle >= (t*0.85)) {
                                this.remove(p.item);
                                particles.splice(i,1);
                            }
                            
                        }
                    }
                };
            };
        </script>
        
        <h3>Graph</h3>
        <p>Hover over the data points to see the value in a pop up</p>
        <canvas id="graph" width="500" height="100" onmousemove="graph_toolTip(event)"></canvas>
        <script type="text/javascript">
            var graph = new cajal('graph');
            var graph_toolTip = function(e) {
                var pos = {
                    x: (e.pageX || e.clientX + document.body.scrollLeft + document.documentElement.scrollLeft) - e.target.offsetLeft,
                    y: (e.pageY || e.clientY + document.body.scrollTop + document.documentElement.scrollTop)  - e.target.offsetTop
                };
                
                var item = graph.getItemAtPoint(graph, pos.x, pos.y);
                if (!!item && !!item.radius && !item.drawOptions.tooltip) {
                    $('<div class="tooltip" style="background:#000;color:#fff;font-size:10px;padding:3px;text-align:center;">' + parseInt(item.drawOptions.data.y) + '</span>')
                        .css('position','absolute')
                        .height(15)
                        .width(30)
                        .css('top', item.itemOptions.translate.y + e.target.offsetTop - 30)
                        .css('left', parseInt(item.itemOptions.translate.x) + e.target.offsetLeft - 18)
                        .appendTo('body').fadeTo(0,0.5);
                    item.drawOptions.tooltip = true;
                } else if (!item) {
                    $('.tooltip').remove();
                    for (var i in graph.items) {
                        graph.items[i].item.drawOptions.tooltip = false;
                    }
                }
            };
            var data = [];
            for (var i=0;i<=20;i++) {
                data.push({ x: i, y: graph.canvas.height/2 + (0.5-Math.random()) * graph.canvas.height });
            }
            
            var lastPoint = null,
                dx = (graph.canvas.width-20) / (data.length - 1),
                dy = (graph.canvas.height-20)/ graph.canvas.height,
                lineStyle = {
                    stroke: '#0088C0'
                };
            
            for (var i in data) {
                
                var coords = {
                    x: 10 + data[i].x * dx,
                    y: -10 + graph.canvas.height - (data[i].y * dy)
                };
                
                if (lastPoint !== null) {
                    var line = new cajal.Path('' + lastPoint.x, lastPoint.y).to(coords.x, coords.y).options(lineStyle);
                    graph.add( line );
                }
                
                var dot = new cajal.Circle('' + coords.x, coords.y,5).options({
                    fill: '#0088C0',
                    data: data[i],
                    tooltip: false
                });
                graph.add( dot );
                
                lastPoint = coords;
            }
            
            graph.draw();
            
        </script>
        
        <h2>Documentation</h2>
        <a href="documentation.html">See the documentation</a>
        
    </div>

    <div id="dotsunited-tab"><a href="http://dotsunited.de">Dots United - Agentur f√ºr neue Medien</a></div>
    <a href="http://github.com/dotsunited/cajal"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://d3nwyuy0nl342s.cloudfront.net/img/4c7dc970b89fd04b81c8e221ba88ff99a06c6b61/687474703a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f77686974655f6666666666662e706e67" alt="Fork me on GitHub"></a>
</body>
</html>
